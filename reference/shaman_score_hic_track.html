<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>generate a score hic track based on observed and expected (shuffled) hic data — shaman_score_hic_track • shaman</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="generate a score hic track based on observed and expected (shuffled) hic data — shaman_score_hic_track"><meta property="og:description" content="shaman_score_hic_track"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">shaman</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/shaman-package.html">
    <span class="fa fa-road"></span>
     
    Usage
  </a>
</li>
<li>
  <a href="../articles/import.html">
    <span class="fa fa-filter"></span>
     
    Import
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-th-list"></span>
     
    Reference
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.org/tanaylab/shaman" class="external-link">
    <span class="fa fa-github-square"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>generate a score hic track based on observed and expected (shuffled) hic data</h1>
    <small class="dont-index">Source: <a href="https://github.com/tanaylab/shaman/blob/HEAD/R/shaman.R" class="external-link"><code>R/shaman.R</code></a></small>
    <div class="hidden name"><code>shaman_score_hic_track.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>shaman_score_hic_track</code></p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">shaman_score_hic_track</span><span class="op">(</span>
  <span class="va">track_db</span>,
  <span class="va">work_dir</span>,
  <span class="va">score_track_nm</span>,
  <span class="va">obs_track_nms</span>,
  exp_track_nms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">obs_track_nms</span>, <span class="st">"_shuffle"</span><span class="op">)</span>,
  points_track_nms <span class="op">=</span> <span class="va">obs_track_nms</span>,
  near_cis <span class="op">=</span> <span class="fl">5000000</span>,
  expand <span class="op">=</span> <span class="fl">2000000</span>,
  k <span class="op">=</span> <span class="fl">100</span>,
  max_jobs <span class="op">=</span> <span class="fl">100</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>track_db</dt>
<dd><p>Directory of the misha database.</p></dd>
<dt>work_dir</dt>
<dd><p>Centralized directory to store temporary files.</p></dd>
<dt>score_track_nm</dt>
<dd><p>Score track that will be created.</p></dd>
<dt>obs_track_nms</dt>
<dd><p>Names of observed 2D genomic tracks for the hic data. Pooling of multiple
observed tracks is supported.</p></dd>
<dt>exp_track_nms</dt>
<dd><p>Names of expected (shuffled) 2D genomic tracks. Pooling of multiple expected
tracks is supported.</p></dd>
<dt>points_track_nms</dt>
<dd><p>Names of 2D genomic tracks that contain points on which to compute
normalized score. Pooling points from multiple tracks is supported.</p></dd>
<dt>near_cis</dt>
<dd><p>Size of matrix in grid.</p></dd>
<dt>expand</dt>
<dd><p>Size of expansion, points to include outside the matrix for accurate computing of the score.
Note that for each observed point, its k-nearest neighbors must be included in the expanded matrix.</p></dd>
<dt>k</dt>
<dd><p>The number of neighbor distances used for the score. For higher resolution maps, increase k. For
lower resolution maps, decrease k.</p></dd>
<dt>max_jobs</dt>
<dd><p>Maximal number of qsub jobs.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function generates a 2D score track based on observed and expected hic data.
The score is computed by generating a grid of small matrices spanning all chromosomes
and computing the score of each matrix independantly.
The model for computing the score relies on the KS D statistic computed for each observed point,
over the distances of the k-nearest neighbors in the observed compared to the expected.
High scores represent contact enrichment while low scores depict insulation.
Note that this function requires either sge (qsub) or multicore to compute in a timely manner.
Parameters can be set via shaman.sge_support or shaman.mc_support in shaman.conf file.
Score computation on 1 billion reads on a distributed system may take 4-10 hours (with default parameters),
depending on the number of cores available.</p>
<p>Each step creates temporary files of the matrix scores which are then joined to a track.
Temporary files are deleted upon track creation.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co"># The example below runs on the test misha db provided with shaman.</span></span>
<span class="r-in"><span class="co"># Note that this is a toy db sampled from K562 ela data -</span></span>
<span class="r-in"><span class="co"># scoring based on the observed and expected tracks will not produce the score track,</span></span>
<span class="r-in"><span class="co"># as most of the genome is missing (you will see message: number of points in focus interval &lt; 1000)</span></span>
<span class="r-in"><span class="co"># options(shaman.sge_support=1) #configuring sge engine mode - preferred</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>shaman.mc_support <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># configuring multi-core mode</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="fu">gtrack.exists</span><span class="op">(</span><span class="st">"hic_score_new"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="fu">gtrack.rm</span><span class="op">(</span><span class="st">"hic_score_new"</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in">    <span class="fu">gdb.reload</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu">shaman_score_hic_track</span><span class="op">(</span><span class="fu"><a href="shaman_get_test_track_db.html">shaman_get_test_track_db</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span class="r-in">    work_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># this can be set only in multi-core mode. For sge mode, work_dir must be accessible by all jobs.</span></span>
<span class="r-in">    score_track_nm <span class="op">=</span> <span class="st">"hic_score_new"</span>,</span>
<span class="r-in">    obs_track_nms <span class="op">=</span> <span class="st">"hic_obs"</span>,</span>
<span class="r-in">    exp_track_nms <span class="op">=</span> <span class="st">"hic_exp"</span>,</span>
<span class="r-in">    near_cis <span class="op">=</span> <span class="fl">1e09</span>, <span class="co"># this test db contains very little data, can increase the size of each job</span></span>
<span class="r-in">    max_jobs <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span> <span class="co"># increase number of jobs for optimal runtime when running in sge mode</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>cannot open compressed file '/home/aviezerl/R/x86_64-pc-linux-gnu-library/4.0/shaman/DESCRIPTION', probable reason 'No such file or directory'</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in setwd(groot):</span> cannot change working directory</span>
<span class="r-in"><span class="fu">gdb.reload</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">gtrack.ls</span><span class="op">(</span><span class="st">"hic_score_new"</span><span class="op">)</span> <span class="co"># new shuffled track that was created</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> character(0)</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Amos Tanay, Netta Mendelson Cohen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

